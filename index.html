<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>Team18-Term-Project</title>
	<script id="vertex-shader" type="x-shader/x-vertex">
		#define MAX_LIGHTS 10
		attribute vec3 vPosition;
		attribute vec3 normal;
		varying vec3 N[MAX_LIGHTS], L[MAX_LIGHTS], E[MAX_LIGHTS];
		uniform vec4 lightPosition[MAX_LIGHTS];
		uniform mat4 projection;
		uniform mat4 modelView;
		uniform mat3 normalMatrix;
		void main() {
			gl_Position = projection * modelView * vec4(vPosition, 1.);

			vec3 pos = (modelView * vec4(vPosition, 1.)).xyz;
			vec3 E0 = -normalize(pos);
			vec3 N0 = normalize(normalMatrix * normal);
			for (int i = 0; i < MAX_LIGHTS; i ++) {
				if (lightPosition[i].z == 0.0)
					L[i] = normalize(lightPosition[i].xyz);
				else
					L[i] = normalize(lightPosition[i]).xyz - pos;

				E[i] = E0;
				N[i] = N0;
			}
		}
	</script>
	<script id="fragment-shader" type="x-shader/x-fragment">
		#define MAX_LIGHTS 10
		precision mediump float;
		uniform float shininess;

		uniform vec4 ambientProduct[MAX_LIGHTS];
		uniform vec4 diffuseProduct[MAX_LIGHTS];
		uniform vec4 specularProduct[MAX_LIGHTS];
		varying vec3 N[MAX_LIGHTS], L[MAX_LIGHTS], E[MAX_LIGHTS];
		void main()
		{
			vec4 fColor = vec4(0.0, 0.0, 0.0, 0.0);
			for (int i = 0; i < MAX_LIGHTS; i ++) {
				vec3 H = normalize(L[i] + E[i]);

				float Kd = max(dot(L[i], N[i]), 0.0);
				vec4 diffuse = Kd * diffuseProduct[i];

				float Ks = pow(max(dot(N[i], H), 0.0), shininess);
				vec4 specular = Ks * specularProduct[i];
				
				if (dot(L[i], N[i]) < 0.0)
					specular = vec4(0.0, 0.0, 0.0, 1.0);

				// TODO: how to blend?
				fColor += ambientProduct[i] + diffuse + specular;
			}
			fColor.a = 1.0;
			gl_FragColor = fColor;
		}
	</script>
	<script type="text/javascript" src="webgl-utils.js"></script>
	<script type="text/javascript" src="initShaders.js"></script>
	<script type="text/javascript" src="MV.js"></script>
	<script type="text/javascript" src="project.js"></script>
</head>
<body>
	<canvas id="gl-canvas" width="1024" height="576">
		Oops ... your browser doesn't support the HTML5 canvas element
	</canvas>
</body>
</html>
